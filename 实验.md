### normal train
    python3 train.py --data voc.yaml --cfg yolov5s_orig.yaml --weights '' --batch-size 112

### train with stripe prune   注意注销掉early stop功能
    python3 train_FS.py --data coco.yaml --cfg yolov5s.yaml --weights '' --batch-size 112 --sr 0.99 --threshold 0.01 --epochs 300
    python3 train_FS.py --data voc.yaml --cfg yolov5s.yaml --weights '' --batch-size 112 --sr 0.99 --threshold 0.01 --epochs 300
    ## 注意，当训练中断后，需要使用--resume, 并且--weights '中断的目录/last.pt'


### 公式 Elastic Net penalty  (sr (0, 1))
    python3 train_prune.py --data voc.yaml --cfg yolov5s.yaml --weights '' --sr 0.1 --threshold 0.01 --Elastic_Net True --batch-size 112

### stripe prune 剪枝
    python3 train_prune.py --data coco.yaml --cfg yolov5s.yaml --weights './runs/train/weights/last.pt' --threshold 0.01 --batch-size 96

### test separately
    python3 val.py --data voc.yaml --img 640 --conf 0.25 --iou 0.45 --weights ./runs/train/exp-mobile_1-yolo5s_voc_sr-0.01_threshold-0.01/prune.pt
    python3 val.py --data voc.yaml --img 640 --conf 0.25 --iou 0.45 --weights ./runs/stripe_experiment/COCO/exp-COCO_0.99_0.01_01/weights/prune.pt

### hyperparameter evolve
bash evolve.sh

### dynamic alpha 将alpha设为lr
python3 train_FS_Dynamic.py --data voc.yaml --cfg yolov5s.yaml --weights '' --batch-size 112 --sr 0.05 --threshold 0.01 --epochs 300

### 论文画图
## figure1
python3 visualize.py --data coco.yaml --cfg yolov5s_orig.yaml --weights 'yolov5s.pt' --flag figure_01

## figure4
# 需要根据不同模型，更换不同cfg, 比如说加入了fs的model和不加fs的，不仅需要换cfg, 也需要在common.py中把Bottleneck里的Conv 或者 Conv_pt换掉; 
# 并且if k == 'model.5.conv_pt': 中的conv_pt也要换掉;
# 如果是baseline, 则--flag baseline, 否则 --flag FS; 默认是baseline
python3 visualize.py --data coco.yaml --cfg yolov5s_orig.yaml --weights 'yolov5s.pt' --flag baseline          # 改common.py 中bottleneck
python3 visualize.py --data coco.yaml --cfg yolov5s.yaml --weights 'yolov5s.pt' --flag FS                     # 改common.py 中bottleneck

## figure7（可视化剪枝后的卷积核）
python3 visualize.py --data coco.yaml --cfg yolov5s.yaml --weights './runs/stripe_experiment/COCO/exp-COCO_0.99_0.01_01/weights/last.pt' --flag figure_07 --threshold 0.01
## fighre8 (对各层的剪枝后的卷积核按照剪枝的比例由低到高进行排序)
python3 visualize.py --data coco.yaml --cfg yolov5s.yaml --weights './runs/stripe_experiment/COCO/exp-COCO_0.99_0.01_01/weights/last.pt' --flag figure_08 --threshold 0.01

#### MobileNet 架构
### normal train
    python3 train.py --data coco.yaml --cfg mobile_1-yolo5s.yaml --weights '' --batch-size 112 

### train with stripe prune
    python3 train_FS.py --data coco.yaml --cfg mobile_1-yolo5s_stripe.yaml --weights '' --Mobilenet True --batch-size 112 --sr 0.99 --threshold 0.01
                                                                                                 --sr 0.01 --threshold 0.01 --epochs 370 

### stripe prune
    python3 train_prune.py --data coco.yaml --cfg mobile_1-yolo5s_stripe.yaml --weights './runs/stripe_experiment/mobilenet/exp-0.99-0.01/weights/last.pt' --Mobilenet True --threshold 0.01 --batch-size 96

### test separately
    python3 val.py --data voc.yaml --img 640 --conf 0.25 --iou 0.45 --weights ./runs/train/exp-mobile_1-yolo5s_voc_sr-0.01_threshold-0.01/prune.pt

### alpha-max 彭老师实验
    # 注意，该实验会更改pytorch里optim文件夹下的SDG文件和function文件，因此在测试完这两个功能后，需要将他们关闭，使用原文件
    废弃 python3 train_FS.py --data coco.yaml --cfg yolov5s.yaml --weights '' --batch-size 112 --sr 0.99 --threshold 0.01 --epochs 300 --alpha_max True
    
    废弃 python3 train_FS_alpha_max_02.py --data voc_test.yaml --cfg yolov5s.yaml --weights '' --batch-size 8 --sr 0.0 --threshold 0.0 --epochs 300
    # bug fix: 修改了params每次只保存了FS的参数，而让其他的参数继续更新的问题。这次保存了所有的参数。2. 在每次求完loss后立马导出导数，不是在param.add_(d_p, alpha=-lr)后面加

    python3 train_FS_alpha_max_03.py --data voc_test.yaml --cfg yolov5s.yaml --weights '' --batch-size 8 --sr 0.0 --threshold 0.0 --epochs 300
                                     --data coco.yaml     --cfg yolov5s.yaml --weights '' --batch-size 64 --sr 0.0 --threshold 0.0 --epochs 300
    具体说明在runs/alpha_max/guaidence.txt中说明
